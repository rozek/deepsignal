!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals"),require("preact/hooks"),require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals","preact/hooks","@preact/signals-core"],t):t((e||self).deepsignal={},0,e.hooks,e.signalsCore)}(this,function(e,t,r,n){var a=new WeakMap,o=new WeakMap,s=new WeakMap,i=new WeakSet,c=new WeakMap,u=/^\$/,l=!1,f=function(e){if(!m(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,g(e,v)),o.get(e)},p=function(e,t){l=!0;var r=e[t];try{l=!1}catch(e){}return r},g=function(e,t){var r=new Proxy(e,t);return i.add(r),r},h=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(t,r,i){var c;if(l)return Reflect.get(t,r,i);var f=e||"$"===r[0]&&"$"!==r;if(!e&&f&&Array.isArray(t)){if("$"===r)return s.has(t)||s.set(t,g(t,d)),s.get(t);f="$length"===r}a.has(i)||a.set(i,new Map);var p=a.get(i),h=f?r.replace(u,""):r;if(p.has(h)||"function"!=typeof(null==(c=Object.getOwnPropertyDescriptor(t,h))?void 0:c.get)){var y=Reflect.get(t,h,i);if(f&&"function"==typeof y)return;if("symbol"==typeof h&&w.has(h))return y;p.has(h)||(m(y)&&(o.has(y)||o.set(y,g(y,v)),y=o.get(y)),p.set(h,n.signal(y))),f||(p.get(h).value=y)}else p.set(h,n.computed(function(){return Reflect.get(t,h,i)}));return f?p.get(h):p.get(h).value}},v={get:y(!1),set:function(e,t,r,s){a.has(s)||a.set(s,new Map);var i=a.get(s);if("$"===t[0]&&"$"!==t){r instanceof n.Signal||h();var c=t.replace(u,"");return i.set(c,r),Reflect.set(e,c,r.peek(),s)}var l=r;m(r)&&(o.has(r)||o.set(r,g(r,v)),l=o.get(r));var f=Reflect.set(e,t,r,s);return i.has(t)?i.get(t).value=l:i.set(t,n.signal(l)),Array.isArray(e)&&i.has("length")&&(i.get("length").value=e.length),f},defineProperty:function(e,t,r){"$"===t[0]&&"$"!==t&&h();var n=!(t in e),s=a.get(o.get(e)),i=Reflect.defineProperty(e,t,r);return"value"in r&&s&&s.has(t)&&(s.get(t).value=r.value),n&&c.has(e)&&c.get(e).value++,i},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&h();var r=a.get(o.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,n},ownKeys:function(e){return c.has(e)||c.set(e,n.signal(0)),c._=c.get(e).value,Reflect.ownKeys(e)}},d={get:y(!0),set:h,deleteProperty:h},w=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),m=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!i.has(e)};function $(e){return o.has(e)}["copyWithin","fill","pop","reverse","shift","sort","splice","unshift"].forEach(function(e){var t;Array.prototype[e]=(t=Array.prototype[e],function(){var e,r=this,a=[].slice.call(arguments);return $(this)?(n.batch(function(){e=t.call.apply(t,[r].concat(a))}),e):t.call.apply(t,[this].concat(a))})}),e.ValueIsDeeplyObserved=$,e.deepSignal=f,e.peek=p,e.shallow=function(e,t){var r=t?p(e,t):e;return i.add(r),r},e.useDeepSignal=function(e){return r.useMemo(function(){return f(e)},[])}});
//# sourceMappingURL=deepsignal.min.js.map
