import"@preact/signals";import{useMemo as t}from"preact/hooks";import{batch as e,Signal as r,signal as n,computed as a}from"@preact/signals-core";var o=new WeakMap,c=new WeakMap,s=new WeakMap,i=new WeakSet,l=new WeakMap,u=/^\$/,p=!1,f=function(t){if(!d(t))throw new Error("This object can't be observed.");return c.has(t)||c.set(t,y(t,w)),c.get(t)},h=function(t,e){p=!0;var r=t[e];try{p=!1}catch(t){}return r},y=function(t,e){var r=new Proxy(t,e);return i.add(r),r},g=function(){throw new Error("Don't mutate the signals directly.")},v=function(t){return function(e,r,i){var l;if(p)return Reflect.get(e,r,i);var f=t||"$"===r[0]&&"$"!==r;if(!t&&f&&Array.isArray(e)){if("$"===r)return s.has(e)||s.set(e,y(e,m)),s.get(e);f="$length"===r}o.has(i)||o.set(i,new Map);var h=o.get(i),g=f?r.replace(u,""):r;if(h.has(g)||"function"!=typeof(null==(l=Object.getOwnPropertyDescriptor(e,g))?void 0:l.get)){var v=Reflect.get(e,g,i);if(f&&"function"==typeof v)return;if("symbol"==typeof g&&b.has(g))return v;h.has(g)||(d(v)&&(c.has(v)||c.set(v,y(v,w)),v=c.get(v)),h.set(g,n(v)))}else h.set(g,a(function(){return Reflect.get(e,g,i)}));return f?h.get(g):h.get(g).value}},w={get:v(!1),set:function(t,e,a,s){o.has(s)||o.set(s,new Map);var i=o.get(s);if("$"===e[0]&&"$"!==e){a instanceof r||g();var l=e.replace(u,"");return i.set(l,a),Reflect.set(t,l,a.peek(),s)}var p=a;d(a)&&(c.has(a)||c.set(a,y(a,w)),p=c.get(a));var f=Reflect.set(t,e,a,s);return i.has(e)?i.get(e).value=p:i.set(e,n(p)),Array.isArray(t)&&i.has("length")&&(i.get("length").value=t.length),f},defineProperty:function(t,e,r){"$"===e[0]&&"$"!==e&&g();var n=!(e in t),a=o.get(c.get(t)),s=Reflect.defineProperty(t,e,r);return"value"in r&&a&&a.has(e)&&(a.get(e).value=r.value),n&&l.has(t)&&l.get(t).value++,s},deleteProperty:function(t,e){"$"===e[0]&&"$"!==e&&g();var r=o.get(c.get(t)),n=Reflect.deleteProperty(t,e);return r&&r.has(e)&&(r.get(e).value=void 0),l.has(t)&&l.get(t).value++,n},ownKeys:function(t){return l.has(t)||l.set(t,n(0)),l._=l.get(t).value,Reflect.ownKeys(t)}},m={get:v(!0),set:g,deleteProperty:g},b=new Set(Object.getOwnPropertyNames(Symbol).map(function(t){return Symbol[t]}).filter(function(t){return"symbol"==typeof t})),A=new Set([Object,Array]),d=function(t){return"object"==typeof t&&null!==t&&(!("function"==typeof t.constructor&&t.constructor.name in globalThis&&globalThis[t.constructor.name]===t.constructor)||A.has(t.constructor))&&!i.has(t)};function $(t){return i.has(t)}var P=Array.prototype.pop;Array.prototype.pop=function(){var t,r=this;return $(this)?(e(function(){t=P.call(r)}),t):P.call(this)};var R=Array.prototype.shift;Array.prototype.shift=function(){var t,r=this;return $(this)?(e(function(){t=R.call(r)}),t):R.call(this)};var k=Array.prototype.unshift;Array.prototype.unshift=function(){var t,r=this,n=[].slice.call(arguments);return $(this)?(e(function(){t=k.call.apply(k,[r].concat(n))}),t):k.call.apply(k,[this].concat(n))};var M=Array.prototype.splice;Array.prototype.splice=function(){var t,r=this,n=[].slice.call(arguments);return $(this)?(e(function(){t=M.call.apply(M,[r].concat(n))}),t):M.call.apply(M,[this].concat(n))};var j=function(e){return t(function(){return f(e)},[])};export{$ as ValueIsDeeplyObserved,f as deepSignal,h as peek,j as useDeepSignal};
//# sourceMappingURL=deepsignal.module.js.map
