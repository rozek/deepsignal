import"@preact/signals";import{useMemo as e}from"preact/hooks";import{Signal as t,signal as r,computed as n}from"@preact/signals-core";var o=new WeakMap,a=new WeakMap,s=new WeakMap,u=new WeakSet,c=new WeakMap,i=/^\$/,f=!1,l=function(e){if(!d(e))throw new Error("This object can't be observed.");return a.has(e)||a.set(e,p(e,v)),a.get(e)},g=function(e,t){return f=!0,f=!1,e[t]},p=function(e,t){var r=new Proxy(e,t);return u.add(r),r},h=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(t,u,c){var l;if(f)return Reflect.get(t,u,c);var g=e||"$"===u[0];if(!e&&g&&Array.isArray(t)){if("$"===u)return s.has(t)||s.set(t,p(t,w)),s.get(t);g="$length"===u}o.has(c)||o.set(c,new Map);var h=o.get(c),y=g?u.replace(i,""):u;if(h.has(y)||"function"!=typeof(null==(l=Object.getOwnPropertyDescriptor(t,y))?void 0:l.get)){var b=Reflect.get(t,y,c);if(g&&"function"==typeof b)return;if("symbol"==typeof y&&m.has(y))return b;h.has(y)||(d(b)&&(a.has(b)||a.set(b,p(b,v)),b=a.get(b)),h.set(y,r(b)))}else h.set(y,n(function(){return Reflect.get(t,y,c)}));return g?h.get(y):h.get(y).value}},v={get:y(!1),set:function(e,n,s,u){o.has(u)||o.set(u,new Map);var f=o.get(u);if("$"===n[0]){s instanceof t||h();var l=n.replace(i,"");return f.set(l,s),Reflect.set(e,l,s.peek(),u)}var g=s;d(s)&&(a.has(s)||a.set(s,p(s,v)),g=a.get(s));var y=!(n in e),w=Reflect.set(e,n,s,u);return f.has(n)?f.get(n).value=g:f.set(n,r(g)),y&&c.has(e)&&c.get(e).value++,Array.isArray(e)&&f.has("length")&&(f.get("length").value=e.length),w},deleteProperty:function(e,t){"$"===t[0]&&h();var r=o.get(a.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,n},ownKeys:function(e){return c.has(e)||c.set(e,r(0)),c.get(e),Reflect.ownKeys(e)}},w={get:y(!0),set:h,deleteProperty:h},m=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),d=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!u.has(e)},k=function(t){return e(function(){return l(t)},[])};export{l as deepSignal,g as peek,k as useDeepSignal};
//# sourceMappingURL=deepsignal.module.js.map
