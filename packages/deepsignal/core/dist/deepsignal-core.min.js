!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-core"],t):t((e||self).deepsignalCore={},e.signalsCore)}(this,function(e,t){var r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakSet,s=new WeakMap,c=/^\$/,i=!1,l=function(e,t){var r=new Proxy(e,t);return o.add(r),r},u=function(){throw new Error("Don't mutate the signals directly.")},f=function(e){return function(o,s,u){var f;if(i)return Reflect.get(o,s,u);var g=e||"$"===s[0]&&"$"!==s;if(!e&&g&&Array.isArray(o)){if("$"===s)return a.has(o)||a.set(o,l(o,h)),a.get(o);g="$length"===s}r.has(u)||r.set(u,new Map);var d=r.get(u),b=g?s.replace(c,""):s;if(d.has(b)||"function"!=typeof(null==(f=Object.getOwnPropertyDescriptor(o,b))?void 0:f.get)){var w=Reflect.get(o,b,u);if(g&&"function"==typeof w)return;if("symbol"==typeof b&&y.has(b))return w;d.has(b)||(v(w)&&(n.has(w)||n.set(w,l(w,p)),w=n.get(w)),d.set(b,t.signal(w)))}else d.set(b,t.computed(function(){return Reflect.get(o,b,u)}));return g?d.get(b):d.get(b).value}},p={get:f(!1),set:function(e,a,o,s){r.has(s)||r.set(s,new Map);var i=r.get(s);if("$"===a[0]&&"$"!==a){o instanceof t.Signal||u();var f=a.replace(c,"");return i.set(f,o),Reflect.set(e,f,o.peek(),s)}var h=o;v(o)&&(n.has(o)||n.set(o,l(o,p)),h=n.get(o));var y=Reflect.set(e,a,o,s);return i.has(a)?i.get(a).value=h:i.set(a,t.signal(h)),Array.isArray(e)&&i.has("length")&&(i.get("length").value=e.length),y},defineProperty:function(e,t,a){"$"===t[0]&&"$"!==t&&u();var o=!(t in e),c=r.get(n.get(e)),i=Reflect.defineProperty(e,t,a);return"value"in a&&c&&c.has(t)&&(c.get(t).value=a.value),o&&s.has(e)&&s.get(e).value++,i},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&u();var a=r.get(n.get(e)),o=Reflect.deleteProperty(e,t);return a&&a.has(t)&&(a.get(t).value=void 0),s.has(e)&&s.get(e).value++,o},ownKeys:function(e){return s.has(e)||s.set(e,t.signal(0)),s._=s.get(e).value,Reflect.ownKeys(e)}},h={get:f(!0),set:u,deleteProperty:u},y=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),g=new Set([Object,Array]),v=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||g.has(e.constructor))&&!o.has(e)};function d(e){return o.has(e)}var b=Array.prototype.pop;Array.prototype.pop=function(){var e,r=this;return d(this)?(t.batch(function(){e=b.call(r)}),e):b.call(this)};var w=Array.prototype.shift;Array.prototype.shift=function(){var e,r=this;return d(this)?(t.batch(function(){e=w.call(r)}),e):w.call(this)};var A=Array.prototype.unshift;Array.prototype.unshift=function(){var e,r=this,n=[].slice.call(arguments);return d(this)?(t.batch(function(){e=A.call.apply(A,[r].concat(n))}),e):A.call.apply(A,[this].concat(n))};var m=Array.prototype.splice;Array.prototype.splice=function(){var e,r=this,n=[].slice.call(arguments);return d(this)?(t.batch(function(){e=m.call.apply(m,[r].concat(n))}),e):m.call.apply(m,[this].concat(n))},e.ValueIsDeeplyObserved=d,e.deepSignal=function(e){if(!v(e))throw new Error("This object can't be observed.");return n.has(e)||n.set(e,l(e,p)),n.get(e)},e.peek=function(e,t){i=!0;var r=e[t];try{i=!1}catch(e){}return r}});
//# sourceMappingURL=deepsignal-core.min.js.map
