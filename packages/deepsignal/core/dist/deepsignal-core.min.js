!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-core"],t):t((e||self).deepsignalCore={},e.signalsCore)}(this,function(e,t){var r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakSet,s=new WeakMap,i=/^\$/,l=!1,c=function(e,t){l=!0;var r=e[t];try{l=!1}catch(e){}return r},u=function(e,t){var r=new Proxy(e,t);return o.add(r),r},f=function(){throw new Error("Don't mutate the signals directly.")},p=function(e){return function(o,s,c){var f;if(l)return Reflect.get(o,s,c);var p=e||"$"===s[0]&&"$"!==s;if(!e&&p&&Array.isArray(o)){if("$"===s)return a.has(o)||a.set(o,u(o,h)),a.get(o);p="$length"===s}r.has(c)||r.set(c,new Map);var v=r.get(c),w=p?s.replace(i,""):s;if(v.has(w)||"function"!=typeof(null==(f=Object.getOwnPropertyDescriptor(o,w))?void 0:f.get)){var b=Reflect.get(o,w,c);if(p&&"function"==typeof b)return;if("symbol"==typeof w&&y.has(w))return b;v.has(w)||(d(b)&&(n.has(b)||n.set(b,u(b,g)),b=n.get(b)),v.set(w,t.signal(b))),v.get(w).value=b}else v.set(w,t.computed(function(){return Reflect.get(o,w,c)}));return p?v.get(w):v.get(w).value}},g={get:p(!1),set:function(e,a,o,s){r.has(s)||r.set(s,new Map);var l=r.get(s);if("$"===a[0]&&"$"!==a){o instanceof t.Signal||f();var c=a.replace(i,"");return l.set(c,o),Reflect.set(e,c,o.peek(),s)}var p=o;d(o)&&(n.has(o)||n.set(o,u(o,g)),p=n.get(o));var h=Reflect.set(e,a,o,s);return l.has(a)?l.get(a).value=p:l.set(a,t.signal(p)),Array.isArray(e)&&l.has("length")&&(l.get("length").value=e.length),h},defineProperty:function(e,t,a){"$"===t[0]&&"$"!==t&&f();var o=!(t in e),i=r.get(n.get(e)),l=Reflect.defineProperty(e,t,a);return"value"in a&&i&&i.has(t)&&(i.get(t).value=a.value),o&&s.has(e)&&s.get(e).value++,l},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&f();var a=r.get(n.get(e)),o=Reflect.deleteProperty(e,t);return a&&a.has(t)&&(a.get(t).value=void 0),s.has(e)&&s.get(e).value++,o},ownKeys:function(e){return s.has(e)||s.set(e,t.signal(0)),s._=s.get(e).value,Reflect.ownKeys(e)}},h={get:p(!0),set:f,deleteProperty:f},y=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),v=new Set([Object,Array]),d=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||v.has(e.constructor))&&!o.has(e)};function w(e){return o.has(e)}["copyWithin","fill","pop","reverse","shift","sort","splice","unshift"].forEach(function(e){var r;Array.prototype[e]=(r=Array.prototype[e],function(){var e,n=this,a=[].slice.call(arguments);return w(this)?(t.batch(function(){e=r.call.apply(r,[n].concat(a))}),e):r.call.apply(r,[this].concat(a))})}),e.ValueIsDeeplyObserved=w,e.deepSignal=function(e){if(!d(e))throw new Error("This object can't be observed.");return n.has(e)||n.set(e,u(e,g)),n.get(e)},e.peek=c,e.shallow=function(e,t){var r=t?c(e,t):e;return o.add(r),r}});
//# sourceMappingURL=deepsignal-core.min.js.map
