import{Signal as e,signal as t,computed as r}from"@preact/signals-core";var n=new WeakMap,a=new WeakMap,o=new WeakMap,s=new WeakSet,u=new WeakMap,c=/^\$/,f=!1,i=function(e){if(!m(e))throw new Error("This object can't be observed.");return a.has(e)||a.set(e,g(e,y)),a.get(e)},l=function(e,t){return f=!0,f=!1,e[t]},g=function(e,t){var r=new Proxy(e,t);return s.add(r),r},h=function(){throw new Error("Don't mutate the signals directly.")},p=function(e){return function(s,u,i){var l;if(f)return Reflect.get(s,u,i);var h=e||"$"===u[0];if(!e&&h&&Array.isArray(s)){if("$"===u)return o.has(s)||o.set(s,g(s,v)),o.get(s);h="$length"===u}n.has(i)||n.set(i,new Map);var p=n.get(i),b=h?u.replace(c,""):u;if(p.has(b)||"function"!=typeof(null==(l=Object.getOwnPropertyDescriptor(s,b))?void 0:l.get)){var d=Reflect.get(s,b,i);if(h&&"function"==typeof d)return;if("symbol"==typeof b&&w.has(b))return d;p.has(b)||(m(d)&&(a.has(d)||a.set(d,g(d,y)),d=a.get(d)),p.set(b,t(d)))}else p.set(b,r(function(){return Reflect.get(s,b,i)}));return h?p.get(b):p.get(b).value}},y={get:p(!1),set:function(r,o,s,f){n.has(f)||n.set(f,new Map);var i=n.get(f);if("$"===o[0]){s instanceof e||h();var l=o.replace(c,"");return i.set(l,s),Reflect.set(r,l,s.peek(),f)}var p=s;m(s)&&(a.has(s)||a.set(s,g(s,y)),p=a.get(s));var v=!(o in r),w=Reflect.set(r,o,s,f);return i.has(o)?i.get(o).value=p:i.set(o,t(p)),v&&u.has(r)&&u.get(r).value++,Array.isArray(r)&&i.has("length")&&(i.get("length").value=r.length),w},deleteProperty:function(e,t){"$"===t[0]&&h();var r=n.get(a.get(e)),o=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),u.has(e)&&u.get(e).value++,o},ownKeys:function(e){return u.has(e)||u.set(e,t(0)),u.get(e),Reflect.ownKeys(e)}},v={get:p(!0),set:h,deleteProperty:h},w=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),m=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!s.has(e)};export{i as deepSignal,l as peek};
//# sourceMappingURL=deepsignal-core.module.js.map
