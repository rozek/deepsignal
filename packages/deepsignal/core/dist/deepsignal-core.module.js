import{batch as e,Signal as t,signal as r,computed as n}from"@preact/signals-core";var a=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,u=new WeakMap,i=/^\$/,l=!1,f=function(e){if(!$(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,g(e,w)),o.get(e)},p=function(e,t){l=!0;var r=e[t];try{l=!1}catch(e){}return r};function h(e,t){var r=t?p(e,t):e;return s.add(r),r}var g=function(e,t){var r=new Proxy(e,t);return s.add(r),r},y=function(){throw new Error("Don't mutate the signals directly.")},v=function(e){return function(t,s,u){var f;if(l)return Reflect.get(t,s,u);var p=e||"$"===s[0]&&"$"!==s;if(!e&&p&&Array.isArray(t)){if("$"===s)return c.has(t)||c.set(t,g(t,b)),c.get(t);p="$length"===s}a.has(u)||a.set(u,new Map);var h=a.get(u),y=p?s.replace(i,""):s;if(h.has(y)||"function"!=typeof(null==(f=Object.getOwnPropertyDescriptor(t,y))?void 0:f.get)){var v=Reflect.get(t,y,u);if(p&&"function"==typeof v)return;if("symbol"==typeof y&&d.has(y))return v;h.has(y)||($(v)&&(o.has(v)||o.set(v,g(v,w)),v=o.get(v)),h.set(y,r(v))),h.get(y).value=v}else h.set(y,n(function(){return Reflect.get(t,y,u)}));return p?h.get(y):h.get(y).value}},w={get:v(!1),set:function(e,n,c,s){a.has(s)||a.set(s,new Map);var u=a.get(s);if("$"===n[0]&&"$"!==n){c instanceof t||y();var l=n.replace(i,"");return u.set(l,c),Reflect.set(e,l,c.peek(),s)}var f=c;$(c)&&(o.has(c)||o.set(c,g(c,w)),f=o.get(c));var p=Reflect.set(e,n,c,s);return u.has(n)?u.get(n).value=f:u.set(n,r(f)),Array.isArray(e)&&u.has("length")&&(u.get("length").value=e.length),p},defineProperty:function(e,t,r){"$"===t[0]&&"$"!==t&&y();var n=!(t in e),c=a.get(o.get(e)),s=Reflect.defineProperty(e,t,r);return"value"in r&&c&&c.has(t)&&(c.get(t).value=r.value),n&&u.has(e)&&u.get(e).value++,s},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&y();var r=a.get(o.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),u.has(e)&&u.get(e).value++,n},ownKeys:function(e){return u.has(e)||u.set(e,r(0)),u._=u.get(e).value,Reflect.ownKeys(e)}},b={get:v(!0),set:y,deleteProperty:y},d=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),m=new Set([Object,Array]),$=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||m.has(e.constructor))&&!s.has(e)};function P(e){return s.has(e)}["copyWithin","fill","pop","reverse","shift","sort","splice","unshift"].forEach(function(t){var r;Array.prototype[t]=(r=Array.prototype[t],function(){var t,n=this,a=[].slice.call(arguments);return P(this)?(e(function(){t=r.call.apply(r,[n].concat(a))}),t):r.call.apply(r,[this].concat(a))})});export{P as ValueIsDeeplyObserved,f as deepSignal,p as peek,h as shallow};
//# sourceMappingURL=deepsignal-core.module.js.map
