import{batch as e,Signal as t,signal as r,computed as n}from"@preact/signals-core";const s=new WeakMap,o=new WeakMap,a=new WeakMap,l=new WeakSet,c=new WeakMap,i=/^\$/;let p=!1;const u=e=>{if(!d(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,f(e,w)),o.get(e)},h=(e,t)=>{p=!0;const r=e[t];try{p=!1}catch(e){}return r},f=(e,t)=>{const r=new Proxy(e,t);return l.add(r),r},y=()=>{throw new Error("Don't mutate the signals directly.")},g=e=>(t,l,c)=>{var u;if(p)return Reflect.get(t,l,c);let h=e||"$"===l[0]&&"$"!==l;if(!e&&h&&Array.isArray(t)){if("$"===l)return a.has(t)||a.set(t,f(t,v)),a.get(t);h="$length"===l}s.has(c)||s.set(c,new Map);const y=s.get(c),g=h?l.replace(i,""):l;if(y.has(g)||"function"!=typeof(null==(u=Object.getOwnPropertyDescriptor(t,g))?void 0:u.get)){let e=Reflect.get(t,g,c);if(h&&"function"==typeof e)return;if("symbol"==typeof g&&b.has(g))return e;y.has(g)||(d(e)&&(o.has(e)||o.set(e,f(e,w)),e=o.get(e)),y.set(g,r(e)))}else y.set(g,n(()=>Reflect.get(t,g,c)));return h?y.get(g):y.get(g).value},w={get:g(!1),set(e,n,a,l){s.has(l)||s.set(l,new Map);const c=s.get(l);if("$"===n[0]&&"$"!==n){a instanceof t||y();const r=n.replace(i,"");return c.set(r,a),Reflect.set(e,r,a.peek(),l)}{let t=a;d(a)&&(o.has(a)||o.set(a,f(a,w)),t=o.get(a));const s=Reflect.set(e,n,a,l);return c.has(n)?c.get(n).value=t:c.set(n,r(t)),Array.isArray(e)&&c.has("length")&&(c.get("length").value=e.length),s}},defineProperty(e,t,r){"$"===t[0]&&"$"!==t&&y();const n=!(t in e),a=s.get(o.get(e)),l=Reflect.defineProperty(e,t,r);return"value"in r&&a&&a.has(t)&&(a.get(t).value=r.value),n&&c.has(e)&&c.get(e).value++,l},deleteProperty(e,t){"$"===t[0]&&"$"!==t&&y();const r=s.get(o.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,n},ownKeys:e=>(c.has(e)||c.set(e,r(0)),c._=c.get(e).value,Reflect.ownKeys(e))},v={get:g(!0),set:y,deleteProperty:y},b=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(e=>"symbol"==typeof e)),A=new Set([Object,Array]),d=e=>"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||A.has(e.constructor))&&!l.has(e);function m(e){return l.has(e)}const $=Array.prototype.pop;Array.prototype.pop=function(){if(m(this)){let t;return e(()=>{t=$.call(this)}),t}return $.call(this)};const P=Array.prototype.shift;Array.prototype.shift=function(){if(m(this)){let t;return e(()=>{t=P.call(this)}),t}return P.call(this)};const R=Array.prototype.unshift;Array.prototype.unshift=function(...t){if(m(this)){let r;return e(()=>{r=R.call(this,...t)}),r}return R.call(this,...t)};const k=Array.prototype.splice;Array.prototype.splice=function(...t){if(m(this)){let r;return e(()=>{r=k.call(this,...t)}),r}return k.call(this,...t)};export{m as ValueIsDeeplyObserved,u as deepSignal,h as peek};
//# sourceMappingURL=deepsignal-core.mjs.map
