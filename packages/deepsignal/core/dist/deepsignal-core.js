var e=require("@preact/signals-core"),t=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakSet,o=new WeakMap,c=/^\$/,s=!1,l=function(e,t){var r=new Proxy(e,t);return a.add(r),r},i=function(){throw new Error("Don't mutate the signals directly.")},u=function(a){return function(o,i,u){var y;if(s)return Reflect.get(o,i,u);var v=a||"$"===i[0]&&"$"!==i;if(!a&&v&&Array.isArray(o)){if("$"===i)return n.has(o)||n.set(o,l(o,f)),n.get(o);v="$length"===i}t.has(u)||t.set(u,new Map);var b=t.get(u),w=v?i.replace(c,""):i;if(b.has(w)||"function"!=typeof(null==(y=Object.getOwnPropertyDescriptor(o,w))?void 0:y.get)){var d=Reflect.get(o,w,u);if(v&&"function"==typeof d)return;if("symbol"==typeof w&&h.has(w))return d;b.has(w)||(g(d)&&(r.has(d)||r.set(d,l(d,p)),d=r.get(d)),b.set(w,e.signal(d)))}else b.set(w,e.computed(function(){return Reflect.get(o,w,u)}));return v?b.get(w):b.get(w).value}},p={get:u(!1),set:function(n,a,o,s){t.has(s)||t.set(s,new Map);var u=t.get(s);if("$"===a[0]&&"$"!==a){o instanceof e.Signal||i();var f=a.replace(c,"");return u.set(f,o),Reflect.set(n,f,o.peek(),s)}var h=o;g(o)&&(r.has(o)||r.set(o,l(o,p)),h=r.get(o));var y=Reflect.set(n,a,o,s);return u.has(a)?u.get(a).value=h:u.set(a,e.signal(h)),Array.isArray(n)&&u.has("length")&&(u.get("length").value=n.length),y},defineProperty:function(e,n,a){"$"===n[0]&&"$"!==n&&i();var c=!(n in e),s=t.get(r.get(e)),l=Reflect.defineProperty(e,n,a);return"value"in a&&s&&s.has(n)&&(s.get(n).value=a.value),c&&o.has(e)&&o.get(e).value++,l},deleteProperty:function(e,n){"$"===n[0]&&"$"!==n&&i();var a=t.get(r.get(e)),c=Reflect.deleteProperty(e,n);return a&&a.has(n)&&(a.get(n).value=void 0),o.has(e)&&o.get(e).value++,c},ownKeys:function(t){return o.has(t)||o.set(t,e.signal(0)),o._=o.get(t).value,Reflect.ownKeys(t)}},f={get:u(!0),set:i,deleteProperty:i},h=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),y=new Set([Object,Array]),g=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||y.has(e.constructor))&&!a.has(e)};function v(e){return a.has(e)}var b=Array.prototype.pop;Array.prototype.pop=function(){var t,r=this;return v(this)?(e.batch(function(){t=b.call(r)}),t):b.call(this)};var w=Array.prototype.shift;Array.prototype.shift=function(){var t,r=this;return v(this)?(e.batch(function(){t=w.call(r)}),t):w.call(this)};var d=Array.prototype.unshift;Array.prototype.unshift=function(){var t,r=this,n=[].slice.call(arguments);return v(this)?(e.batch(function(){t=d.call.apply(d,[r].concat(n))}),t):d.call.apply(d,[this].concat(n))};var A=Array.prototype.splice;Array.prototype.splice=function(){var t,r=this,n=[].slice.call(arguments);return v(this)?(e.batch(function(){t=A.call.apply(A,[r].concat(n))}),t):A.call.apply(A,[this].concat(n))},exports.ValueIsDeeplyObserved=v,exports.deepSignal=function(e){if(!g(e))throw new Error("This object can't be observed.");return r.has(e)||r.set(e,l(e,p)),r.get(e)},exports.peek=function(e,t){s=!0;var r=e[t];try{s=!1}catch(e){}return r};
//# sourceMappingURL=deepsignal-core.js.map
