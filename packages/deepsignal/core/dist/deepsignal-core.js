var e=require("@preact/signals-core"),t=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakSet,o=new WeakMap,s=/^\$/,c=!1,l=function(e,t){c=!0;var r=e[t];try{c=!1}catch(e){}return r},u=function(e,t){var r=new Proxy(e,t);return a.add(r),r},i=function(){throw new Error("Don't mutate the signals directly.")},f=function(a){return function(o,l,i){var f;if(c)return Reflect.get(o,l,i);var y=a||"$"===l[0]&&"$"!==l;if(!a&&y&&Array.isArray(o)){if("$"===l)return n.has(o)||n.set(o,u(o,g)),n.get(o);y="$length"===l}t.has(i)||t.set(i,new Map);var w=t.get(i),d=y?l.replace(s,""):l;if(w.has(d)||"function"!=typeof(null==(f=Object.getOwnPropertyDescriptor(o,d))?void 0:f.get)){var b=Reflect.get(o,d,i);if(y&&"function"==typeof b)return;if("symbol"==typeof d&&h.has(d))return b;w.has(d)||(v(b)&&(r.has(b)||r.set(b,u(b,p)),b=r.get(b)),w.set(d,e.signal(b))),w.get(d).value=b}else w.set(d,e.computed(function(){return Reflect.get(o,d,i)}));return y?w.get(d):w.get(d).value}},p={get:f(!1),set:function(n,a,o,c){t.has(c)||t.set(c,new Map);var l=t.get(c);if("$"===a[0]&&"$"!==a){o instanceof e.Signal||i();var f=a.replace(s,"");return l.set(f,o),Reflect.set(n,f,o.peek(),c)}var g=o;v(o)&&(r.has(o)||r.set(o,u(o,p)),g=r.get(o));var h=Reflect.set(n,a,o,c);return l.has(a)?l.get(a).value=g:l.set(a,e.signal(g)),Array.isArray(n)&&l.has("length")&&(l.get("length").value=n.length),h},defineProperty:function(e,n,a){"$"===n[0]&&"$"!==n&&i();var s=!(n in e),c=t.get(r.get(e)),l=Reflect.defineProperty(e,n,a);return"value"in a&&c&&c.has(n)&&(c.get(n).value=a.value),s&&o.has(e)&&o.get(e).value++,l},deleteProperty:function(e,n){"$"===n[0]&&"$"!==n&&i();var a=t.get(r.get(e)),s=Reflect.deleteProperty(e,n);return a&&a.has(n)&&(a.get(n).value=void 0),o.has(e)&&o.get(e).value++,s},ownKeys:function(t){return o.has(t)||o.set(t,e.signal(0)),o._=o.get(t).value,Reflect.ownKeys(t)}},g={get:f(!0),set:i,deleteProperty:i},h=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),y=new Set([Object,Array]),v=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||y.has(e.constructor))&&!a.has(e)};function w(e){return a.has(e)}["copyWithin","fill","pop","reverse","shift","sort","splice","unshift"].forEach(function(t){var r;Array.prototype[t]=(r=Array.prototype[t],function(){var t,n=this,a=[].slice.call(arguments);return w(this)?(e.batch(function(){t=r.call.apply(r,[n].concat(a))}),t):r.call.apply(r,[this].concat(a))})}),exports.ValueIsDeeplyObserved=w,exports.deepSignal=function(e){if(!v(e))throw new Error("This object can't be observed.");return r.has(e)||r.set(e,u(e,p)),r.get(e)},exports.peek=l,exports.shallow=function(e,t){var r=t?l(e,t):e;return a.add(r),r};
//# sourceMappingURL=deepsignal-core.js.map
