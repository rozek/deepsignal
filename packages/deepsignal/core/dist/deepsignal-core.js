var e=require("@preact/signals-core"),t=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakSet,o=new WeakMap,s=/^\$/,u=!1,c=function(e,t){var r=new Proxy(e,t);return a.add(r),r},i=function(){throw new Error("Don't mutate the signals directly.")},l=function(a){return function(o,i,l){var h;if(u)return Reflect.get(o,i,l);var v=a||"$"===i[0]&&"$"!==i;if(!a&&v&&Array.isArray(o)){if("$"===i)return n.has(o)||n.set(o,c(o,g)),n.get(o);v="$length"===i}t.has(l)||t.set(l,new Map);var w=t.get(l),b=v?i.replace(s,""):i;if(w.has(b)||"function"!=typeof(null==(h=Object.getOwnPropertyDescriptor(o,b))?void 0:h.get)){var d=Reflect.get(o,b,l);if(v&&"function"==typeof d)return;if("symbol"==typeof b&&p.has(b))return d;w.has(b)||(y(d)&&(r.has(d)||r.set(d,c(d,f)),d=r.get(d)),w.set(b,e.signal(d)))}else w.set(b,e.computed(function(){return Reflect.get(o,b,l)}));return v?w.get(b):w.get(b).value}},f={get:l(!1),set:function(n,a,o,u){t.has(u)||t.set(u,new Map);var l=t.get(u);if("$"===a[0]&&"$"!==a){o instanceof e.Signal||i();var g=a.replace(s,"");return l.set(g,o),Reflect.set(n,g,o.peek(),u)}var p=o;y(o)&&(r.has(o)||r.set(o,c(o,f)),p=r.get(o));var h=Reflect.set(n,a,o,u);return l.has(a)?l.get(a).value=p:l.set(a,e.signal(p)),Array.isArray(n)&&l.has("length")&&(l.get("length").value=n.length),h},defineProperty:function(e,n,a){"$"===n[0]&&"$"!==n&&i();var s=!(n in e),u=t.get(r.get(e)),c=Reflect.defineProperty(e,n,a);return"value"in a&&u&&u.has(n)&&(u.get(n).value=a.value),s&&o.has(e)&&o.get(e).value++,c},deleteProperty:function(e,n){"$"===n[0]&&"$"!==n&&i();var a=t.get(r.get(e)),s=Reflect.deleteProperty(e,n);return a&&a.has(n)&&(a.get(n).value=void 0),o.has(e)&&o.get(e).value++,s},ownKeys:function(t){return o.has(t)||o.set(t,e.signal(0)),o._=o.get(t).value,Reflect.ownKeys(t)}},g={get:l(!0),set:i,deleteProperty:i},p=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),h=new Set([Object,Array]),y=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||h.has(e.constructor))&&!a.has(e)};exports.deepSignal=function(e){if(!y(e))throw new Error("This object can't be observed.");return r.has(e)||r.set(e,c(e,f)),r.get(e)},exports.peek=function(e,t){u=!0;var r=e[t];try{u=!1}catch(e){}return r};
//# sourceMappingURL=deepsignal-core.js.map
