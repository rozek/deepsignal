{"version":3,"file":"deepsignal-core.min.js","sources":["../src/index.ts"],"sourcesContent":["import { batch, computed, signal, Signal } from \"@preact/signals-core\";\n\nconst proxyToSignals = new WeakMap();\nconst objToProxy = new WeakMap();\nconst arrayToArrayOfSignals = new WeakMap();\nconst proxies = new WeakSet();\nconst objToIterable = new WeakMap();\nconst rg = /^\\$/;\nlet peeking = false;\n\nexport const deepSignal = <T extends object>(obj: T): DeepSignal<T> => {\n\tif (!shouldProxy(obj)) throw new Error(\"This object can't be observed.\");\n\tif (!objToProxy.has(obj))\n\t\tobjToProxy.set(obj, createProxy(obj, objectHandlers) as DeepSignal<T>);\n\treturn objToProxy.get(obj);\n};\n\nexport const peek = <\n\tT extends DeepSignalObject<object>,\n\tK extends keyof RevertDeepSignalObject<T>\n>(\n\tobj: T,\n\tkey: K\n): RevertDeepSignal<RevertDeepSignalObject<T>[K]> => {\n\tpeeking = true;\n\tconst value = obj[key];\n\ttry {\n\t\tpeeking = false;\n\t} catch (e) {}\n\treturn value as RevertDeepSignal<RevertDeepSignalObject<T>[K]>;\n};\n\nconst createProxy = (target: object, handlers: ProxyHandler<object>) => {\n\tconst proxy = new Proxy(target, handlers);\n\tproxies.add(proxy);\n\treturn proxy;\n};\n\nconst throwOnMutation = () => {\n\tthrow new Error(\"Don't mutate the signals directly.\");\n};\n\nconst get = (isArrayOfSignals: boolean) =>\n\t(target: object, fullKey: string, receiver: object): unknown => {\n\t\tif (peeking) return Reflect.get(target, fullKey, receiver);\n\t\tlet returnSignal = isArrayOfSignals || (fullKey[0] === \"$\") && (fullKey !== '$');\n\t\tif (!isArrayOfSignals && returnSignal && Array.isArray(target)) {\n\t\t\tif (fullKey === \"$\") {\n\t\t\t\tif (!arrayToArrayOfSignals.has(target))\n\t\t\t\t\tarrayToArrayOfSignals.set(target, createProxy(target, arrayHandlers));\n\t\t\t\treturn arrayToArrayOfSignals.get(target);\n\t\t\t}\n\t\t\treturnSignal = fullKey === \"$length\";\n\t\t}\n\n\t\tif (!proxyToSignals.has(receiver)) proxyToSignals.set(receiver, new Map());\n\n\t\tconst signals = proxyToSignals.get(receiver);\n\t\tconst key = returnSignal ? fullKey.replace(rg, \"\") : fullKey;\n\t\tif (\n\t\t\t!signals.has(key) &&\n\t\t\ttypeof Object.getOwnPropertyDescriptor(target, key)?.get === \"function\"\n\t\t) {\n\t\t\tsignals.set(\n\t\t\t\tkey,\n\t\t\t\tcomputed(() => Reflect.get(target, key, receiver))\n\t\t\t);\n\t\t} else {\n\t\t\tlet value = Reflect.get(target, key, receiver);\n\t\t\tif (returnSignal && typeof value === \"function\") return;\n\n\t\t\tif (typeof key === \"symbol\" && wellKnownSymbols.has(key)) return value;\n\t\t\t// TODO: doesn't \"typeof key\" always yield \"string\"?\n\n\t\t\tif (!signals.has(key)) {\n\t\t\t\tif (shouldProxy(value)) {\n\t\t\t\t\tif (!objToProxy.has(value))\n\t\t\t\t\t\tobjToProxy.set(value, createProxy(value, objectHandlers));\n\t\t\t\t\tvalue = objToProxy.get(value);\n\t\t\t\t}\n\t\t\t\tsignals.set(key, signal(value));\n\t\t\t}\n\t\t}\n\t\treturn returnSignal ? signals.get(key) : signals.get(key).value;\n\t};\n\nconst objectHandlers = {\n\tget: get(false),\n\n\tset(target: object, fullKey: string, val: any, receiver: object): boolean {\n\t\tif (!proxyToSignals.has(receiver)) proxyToSignals.set(receiver, new Map());\n\t\tconst signals = proxyToSignals.get(receiver);\n\t\tif ((fullKey[0] === \"$\") && (fullKey !== '$')) {\n\t\t\tif (!(val instanceof Signal)) throwOnMutation();\n\t\t\tconst key = fullKey.replace(rg, \"\");\n\t\t\tsignals.set(key, val);\n\t\t\treturn Reflect.set(target, key, val.peek(), receiver);\n\t\t} else {\n\t\t\tlet internal = val;\n\t\t\tif (shouldProxy(val)) {\n\t\t\t\tif (!objToProxy.has(val))\n\t\t\t\t\tobjToProxy.set(val, createProxy(val, objectHandlers));\n\t\t\t\tinternal = objToProxy.get(val);\n\t\t\t}\n\t\t\tconst result = Reflect.set(target, fullKey, val, receiver);\n\t\t\tif (!signals.has(fullKey)) signals.set(fullKey, signal(internal));\n\t\t\telse signals.get(fullKey).value = internal;\n\t\t\tif (Array.isArray(target) && signals.has(\"length\"))\n\t\t\t\tsignals.get(\"length\").value = target.length;\n\t\t\treturn result;\n\t\t}\n\t},\n\n\tdefineProperty (target:object, key:string, descriptor:object):boolean {\n\t\tif ((key[0] === \"$\") && (key !== '$')) throwOnMutation();\n\n\t\tconst isNew = ! (key in target)\n\n\t  const signals = proxyToSignals.get(objToProxy.get(target))\n\t\tconst Result:boolean = Reflect.defineProperty(target,key,descriptor)\n\t\t\tif ('value' in descriptor) {\n\t\t\t\tif (signals && signals.has(key)) signals.get(key).value = descriptor.value\n\t\t\t}\n\n\t\t\tif (isNew && objToIterable.has(target)) {\n\t\t\t\tobjToIterable.get(target).value++\n\t\t\t}\n\t\treturn Result\n\t},\n\n\tdeleteProperty(target: object, key: string): boolean {\n\t\tif ((key[0] === \"$\") && (key !== '$')) throwOnMutation();\n\t\tconst signals = proxyToSignals.get(objToProxy.get(target));\n\t\tconst result = Reflect.deleteProperty(target, key);\n\t\tif (signals && signals.has(key)) signals.get(key).value = undefined;\n\t\tobjToIterable.has(target) && objToIterable.get(target).value++;\n\t\treturn result;\n\t},\n\n\townKeys(target: object): (string | symbol)[] {\n\t\tif (!objToIterable.has(target)) objToIterable.set(target, signal(0));\n\t\t(objToIterable as any)._ = objToIterable.get(target).value;\n\t\treturn Reflect.ownKeys(target);\n\t},\n};\n\nconst arrayHandlers = {\n\tget: get(true),\n\tset: throwOnMutation,\n\tdeleteProperty: throwOnMutation,\n};\n\nconst wellKnownSymbols = new Set(\n\tObject.getOwnPropertyNames(Symbol)\n\t\t.map(key => Symbol[key as WellKnownSymbols])\n\t\t.filter(value => typeof value === \"symbol\")\n);\nconst supported = new Set([Object, Array]);\nconst shouldProxy = (val: any): boolean => {\n\tif (typeof val !== \"object\" || val === null) return false;\n\tconst isBuiltIn =\n\t\ttypeof val.constructor === \"function\" &&\n\t\tval.constructor.name in globalThis &&\n\t\t(globalThis as any)[val.constructor.name] === val.constructor;\n\treturn (!isBuiltIn || supported.has(val.constructor)) && !proxies.has(val);\n};\n\n/**** additional support for some Array methods ****/\n\n\texport function ValueIsDeeplyObserved (Value:any):boolean {\n\t  return proxies.has(Value)\n\t}\n\n/**** Array.pop ****/\n\n  const Array_pop = Array.prototype.pop\n  Array.prototype.pop = function ():any {\n    if (ValueIsDeeplyObserved(this)) {\n      let Result\n        batch(() => { Result = Array_pop.call(this) })\n      return Result\n    } else {\n      return Array_pop.call(this)\n    }\n  }\n\n/**** Array.push ****/\n\n// Array.push works out of the box\n\n/**** Array.shift ****/\n\n  const Array_shift = Array.prototype.shift\n  Array.prototype.shift = function ():any {\n    if (ValueIsDeeplyObserved(this)) {\n      let Result\n        batch(() => { Result = Array_shift.call(this) })\n      return Result\n    } else {\n      return Array_shift.call(this)\n    }\n  }\n\n/**** Array.unshift ****/\n\n  const Array_unshift = Array.prototype.unshift\n  Array.prototype.unshift = function (...Arguments:any[]):number {\n    if (ValueIsDeeplyObserved(this)) {\n      let Result\n        batch(() => { Result = Array_unshift.call(this,...Arguments) })\n// @ts-ignore TS2352 no conversion necessary\n      return Result\n    } else {\n      return Array_unshift.call(this,...Arguments)\n    }\n  }\n\n/**** Array.splice ****/\n\n  const Array_splice = Array.prototype.splice\n  Array.prototype.splice = function (...Arguments:any[]):any[] {\n    if (ValueIsDeeplyObserved(this)) {\n      let Result\n// @ts-ignore TS2345 te given kind of argument passing is ok\n        batch(() => { Result = Array_splice.call(this,...Arguments) })\n// @ts-ignore TS2352 no conversion necessary\n      return Result\n    } else {\n// @ts-ignore TS2345 te given kind of argument passing is ok\n      return Array_splice.call(this,...Arguments)\n    }\n  }\n\n/** TYPES **/\n\nexport type DeepSignal<T> = T extends Function\n\t? T\n\t: T extends Array<unknown>\n\t? DeepSignalArray<T>\n\t: T extends object\n\t? DeepSignalObject<T>\n\t: T;\n\ntype DeepSignalObject<T extends object> = {\n\t[P in keyof T & string as `$${P}`]?: T[P] extends Function\n\t\t? never\n\t\t: Signal<T[P]>;\n} & {\n\t[P in keyof T]: DeepSignal<T[P]>;\n};\n\n/** @ts-expect-error **/\ninterface DeepArray<T> extends Array<T> {\n\tmap: <U>(\n\t\tcallbackfn: (\n\t\t\tvalue: DeepSignal<T>,\n\t\t\tindex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => U,\n\t\tthisArg?: any\n\t) => U[];\n\tforEach: (\n\t\tcallbackfn: (\n\t\t\tvalue: DeepSignal<T>,\n\t\t\tindex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => void,\n\t\tthisArg?: any\n\t) => void;\n\tconcat(...items: ConcatArray<T>[]): DeepSignalArray<T[]>;\n\tconcat(...items: (T | ConcatArray<T>)[]): DeepSignalArray<T[]>;\n\treverse(): DeepSignalArray<T[]>;\n\tshift(): DeepSignal<T> | undefined;\n\tslice(start?: number, end?: number): DeepSignalArray<T[]>;\n\tsplice(start: number, deleteCount?: number): DeepSignalArray<T[]>;\n\tsplice(\n\t\tstart: number,\n\t\tdeleteCount: number,\n\t\t...items: T[]\n\t): DeepSignalArray<T[]>;\n\tfilter<S extends T>(\n\t\tpredicate: (\n\t\t\tvalue: DeepSignal<T>,\n\t\t\tindex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => value is DeepSignal<S>,\n\t\tthisArg?: any\n\t): DeepSignalArray<S[]>;\n\tfilter(\n\t\tpredicate: (\n\t\t\tvalue: DeepSignal<T>,\n\t\t\tindex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => unknown,\n\t\tthisArg?: any\n\t): DeepSignalArray<T[]>;\n\treduce(\n\t\tcallbackfn: (\n\t\t\tpreviousValue: DeepSignal<T>,\n\t\t\tcurrentValue: DeepSignal<T>,\n\t\t\tcurrentIndex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => T\n\t): DeepSignal<T>;\n\treduce(\n\t\tcallbackfn: (\n\t\t\tpreviousValue: DeepSignal<T>,\n\t\t\tcurrentValue: DeepSignal<T>,\n\t\t\tcurrentIndex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => DeepSignal<T>,\n\t\tinitialValue: T\n\t): DeepSignal<T>;\n\treduce<U>(\n\t\tcallbackfn: (\n\t\t\tpreviousValue: U,\n\t\t\tcurrentValue: DeepSignal<T>,\n\t\t\tcurrentIndex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => U,\n\t\tinitialValue: U\n\t): U;\n\treduceRight(\n\t\tcallbackfn: (\n\t\t\tpreviousValue: DeepSignal<T>,\n\t\t\tcurrentValue: DeepSignal<T>,\n\t\t\tcurrentIndex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => T\n\t): DeepSignal<T>;\n\treduceRight(\n\t\tcallbackfn: (\n\t\t\tpreviousValue: DeepSignal<T>,\n\t\t\tcurrentValue: DeepSignal<T>,\n\t\t\tcurrentIndex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => DeepSignal<T>,\n\t\tinitialValue: T\n\t): DeepSignal<T>;\n\treduceRight<U>(\n\t\tcallbackfn: (\n\t\t\tpreviousValue: U,\n\t\t\tcurrentValue: DeepSignal<T>,\n\t\t\tcurrentIndex: number,\n\t\t\tarray: DeepSignalArray<T[]>\n\t\t) => U,\n\t\tinitialValue: U\n\t): U;\n}\ntype ArrayType<T> = T extends Array<infer I> ? I : T;\ntype DeepSignalArray<T> = DeepArray<ArrayType<T>> & {\n\t[key: number]: DeepSignal<ArrayType<T>>;\n\t$?: { [key: number]: Signal<ArrayType<T>> };\n\t$length?: Signal<number>;\n};\n\nexport declare const useDeepSignal: <T extends object>(obj: T) => DeepSignal<T>;\n\ntype FilterSignals<K> = K extends `$${infer P}` ? never : K;\ntype RevertDeepSignalObject<T> = Pick<T, FilterSignals<keyof T>>;\ntype RevertDeepSignalArray<T> = Omit<T, \"$\" | \"$length\">;\n\nexport type RevertDeepSignal<T> = T extends Array<unknown>\n\t? RevertDeepSignalArray<T>\n\t: T extends object\n\t? RevertDeepSignalObject<T>\n\t: T;\n\ntype WellKnownSymbols =\n\t| \"asyncIterator\"\n\t| \"hasInstance\"\n\t| \"isConcatSpreadable\"\n\t| \"iterator\"\n\t| \"match\"\n\t| \"matchAll\"\n\t| \"replace\"\n\t| \"search\"\n\t| \"species\"\n\t| \"split\"\n\t| \"toPrimitive\"\n\t| \"toStringTag\"\n\t| \"unscopables\";\n"],"names":["proxyToSignals","WeakMap","objToProxy","arrayToArrayOfSignals","proxies","WeakSet","objToIterable","rg","peeking","createProxy","target","handlers","proxy","Proxy","add","throwOnMutation","Error","get","isArrayOfSignals","fullKey","receiver","_Object$getOwnPropert","Reflect","returnSignal","Array","isArray","has","set","arrayHandlers","Map","signals","key","replace","Object","getOwnPropertyDescriptor","value","wellKnownSymbols","shouldProxy","objectHandlers","signal","computed","val","Signal","peek","internal","result","length","defineProperty","descriptor","isNew","Result","deleteProperty","undefined","ownKeys","_","Set","getOwnPropertyNames","Symbol","map","filter","supported","constructor","name","globalThis","ValueIsDeeplyObserved","Value","Array_pop","prototype","pop","_this","this","batch","call","Array_shift","shift","_this2","Array_unshift","unshift","_this3","Arguments","slice","arguments","apply","concat","Array_splice","splice","_this4","obj","e"],"mappings":"+SAEA,IAAMA,EAAiB,IAAIC,QACrBC,EAAa,IAAID,QACjBE,EAAwB,IAAIF,QAC5BG,EAAU,IAAIC,QACdC,EAAgB,IAAIL,QACpBM,EAAK,MACPC,GAAU,EAwBRC,EAAc,SAACC,EAAgBC,GACpC,IAAMC,EAAQ,IAAIC,MAAMH,EAAQC,GAEhC,OADAP,EAAQU,IAAIF,GACLA,CACR,EAEMG,EAAkB,WACvB,UAAUC,MAAM,qCACjB,EAEMC,EAAM,SAACC,GAAyB,gBACpCR,EAAgBS,EAAiBC,GAA6BC,IAAAA,EAC9D,GAAIb,EAAS,OAAOc,QAAQL,IAAIP,EAAQS,EAASC,GACjD,IAAIG,EAAeL,GAAoC,MAAfC,EAAQ,IAA4B,MAAZA,EAChE,IAAKD,GAAoBK,GAAgBC,MAAMC,QAAQf,GAAS,CAC/D,GAAgB,MAAZS,EAGH,OAFKhB,EAAsBuB,IAAIhB,IAC9BP,EAAsBwB,IAAIjB,EAAQD,EAAYC,EAAQkB,IAChDzB,EAAsBc,IAAIP,GAElCa,EAA2B,YAAZJ,CACf,CAEInB,EAAe0B,IAAIN,IAAWpB,EAAe2B,IAAIP,EAAU,IAAIS,KAEpE,IAAMC,EAAU9B,EAAeiB,IAAIG,GAC7BW,EAAMR,EAAeJ,EAAQa,QAAQzB,EAAI,IAAMY,EACrD,GACEW,EAAQJ,IAAIK,IACgD,mBAAtDV,OAAPA,EAAOY,OAAOC,yBAAyBxB,EAAQqB,SAAxCV,EAAAA,EAA8CJ,KAM/C,CACN,IAAIkB,EAAQb,QAAQL,IAAIP,EAAQqB,EAAKX,GACrC,GAAIG,GAAiC,mBAAVY,EAAsB,OAEjD,GAAmB,iBAARJ,GAAoBK,EAAiBV,IAAIK,GAAM,OAAOI,EAG5DL,EAAQJ,IAAIK,KACZM,EAAYF,KACVjC,EAAWwB,IAAIS,IACnBjC,EAAWyB,IAAIQ,EAAO1B,EAAY0B,EAAOG,IAC1CH,EAAQjC,EAAWe,IAAIkB,IAExBL,EAAQH,IAAII,EAAKQ,EAAAA,OAAOJ,IAEzB,MAnBAL,EAAQH,IACPI,EACAS,EAAQA,SAAC,WAAA,OAAMlB,QAAQL,IAAIP,EAAQqB,EAAKX,EAAS,IAkBnD,OAAOG,EAAeO,EAAQb,IAAIc,GAAOD,EAAQb,IAAIc,GAAKI,KAC3D,CAAC,EAEIG,EAAiB,CACtBrB,IAAKA,GAAI,GAETU,aAAIjB,EAAgBS,EAAiBsB,EAAUrB,GACzCpB,EAAe0B,IAAIN,IAAWpB,EAAe2B,IAAIP,EAAU,IAAIS,KACpE,IAAMC,EAAU9B,EAAeiB,IAAIG,GACnC,GAAoB,MAAfD,EAAQ,IAA4B,MAAZA,EAAkB,CACxCsB,aAAeC,EAAMA,QAAG3B,IAC9B,IAAMgB,EAAMZ,EAAQa,QAAQzB,EAAI,IAEhC,OADAuB,EAAQH,IAAII,EAAKU,GACVnB,QAAQK,IAAIjB,EAAQqB,EAAKU,EAAIE,OAAQvB,EAC5C,CACA,IAAIwB,EAAWH,EACXJ,EAAYI,KACVvC,EAAWwB,IAAIe,IACnBvC,EAAWyB,IAAIc,EAAKhC,EAAYgC,EAAKH,IACtCM,EAAW1C,EAAWe,IAAIwB,IAE3B,IAAMI,EAASvB,QAAQK,IAAIjB,EAAQS,EAASsB,EAAKrB,GAKjD,OAJKU,EAAQJ,IAAIP,GACZW,EAAQb,IAAIE,GAASgB,MAAQS,EADPd,EAAQH,IAAIR,EAASoB,EAAMA,OAACK,IAEnDpB,MAAMC,QAAQf,IAAWoB,EAAQJ,IAAI,YACxCI,EAAQb,IAAI,UAAUkB,MAAQzB,EAAOoC,QAC/BD,CAET,EAEAE,eAAc,SAAErC,EAAeqB,EAAYiB,GAC1B,MAAXjB,EAAI,IAAwB,MAARA,GAAchB,IAEvC,IAAMkC,IAAWlB,KAAOrB,GAEjBoB,EAAU9B,EAAeiB,IAAIf,EAAWe,IAAIP,IAC7CwC,EAAiB5B,QAAQyB,eAAerC,EAAOqB,EAAIiB,GAQzD,MAPK,UAAWA,GACVlB,GAAWA,EAAQJ,IAAIK,KAAMD,EAAQb,IAAIc,GAAKI,MAAQa,EAAWb,OAGlEc,GAAS3C,EAAcoB,IAAIhB,IAC9BJ,EAAcW,IAAIP,GAAQyB,QAErBe,CACR,EAEAC,eAAcA,SAACzC,EAAgBqB,GACd,MAAXA,EAAI,IAAwB,MAARA,GAAchB,IACvC,IAAMe,EAAU9B,EAAeiB,IAAIf,EAAWe,IAAIP,IAC5CmC,EAASvB,QAAQ6B,eAAezC,EAAQqB,GAG9C,OAFID,GAAWA,EAAQJ,IAAIK,KAAMD,EAAQb,IAAIc,GAAKI,WAAQiB,GAC1D9C,EAAcoB,IAAIhB,IAAWJ,EAAcW,IAAIP,GAAQyB,QAChDU,CACR,EAEAQ,QAAO,SAAC3C,GAGP,OAFKJ,EAAcoB,IAAIhB,IAASJ,EAAcqB,IAAIjB,EAAQ6B,SAAO,IAChEjC,EAAsBgD,EAAIhD,EAAcW,IAAIP,GAAQyB,MAC9Cb,QAAQ+B,QAAQ3C,EACxB,GAGKkB,EAAgB,CACrBX,IAAKA,GAAI,GACTU,IAAKZ,EACLoC,eAAgBpC,GAGXqB,EAAmB,IAAImB,IAC5BtB,OAAOuB,oBAAoBC,QACzBC,IAAI,SAAA3B,UAAO0B,OAAO1B,EAAwB,GAC1C4B,OAAO,SAAAxB,SAA0B,iBAAVA,CAAkB,IAEtCyB,EAAY,IAAIL,IAAI,CAACtB,OAAQT,QAC7Ba,EAAc,SAACI,GACpB,MAAmB,iBAARA,GAA4B,OAARA,MAEH,mBAApBA,EAAIoB,aACXpB,EAAIoB,YAAYC,QAAQC,YACvBA,WAAmBtB,EAAIoB,YAAYC,QAAUrB,EAAIoB,cAC7BD,EAAUlC,IAAIe,EAAIoB,gBAAkBzD,EAAQsB,IAAIe,EACvE,EAIiB,SAAAuB,EAAuBC,GACrC,OAAO7D,EAAQsB,IAAIuC,EACrB,CAIC,IAAMC,EAAY1C,MAAM2C,UAAUC,IAClC5C,MAAM2C,UAAUC,IAAM,eAEdlB,EAFcmB,EAAAC,KACpB,OAAIN,EAAsBM,OAEtBC,EAAAA,MAAM,WAAQrB,EAASgB,EAAUM,KAAKH,EAAM,GACvCnB,GAEAgB,EAAUM,KAAKF,KAE1B,EAQA,IAAMG,EAAcjD,MAAM2C,UAAUO,MACpClD,MAAM2C,UAAUO,MAAQ,WAAA,IAEhBxB,EAFgByB,EACtBL,KAAA,OAAIN,EAAsBM,OAEtBC,QAAM,WAAQrB,EAASuB,EAAYD,KAAKG,EAAM,GACzCzB,GAEAuB,EAAYD,KAAKF,KAE5B,EAIA,IAAMM,EAAgBpD,MAAM2C,UAAUU,QACtCrD,MAAM2C,UAAUU,QAAU,WAA4BC,IAE9C5B,EAF8C4B,OAAfC,KAAeC,MAAAR,KAAAS,WACpD,OAAIjB,EAAsBM,OAEtBC,QAAM,WAAQrB,EAAS0B,EAAcJ,KAAIU,MAAlBN,GAAmBE,GAAIK,OAAIJ,GAAW,GAExD7B,GAEA0B,EAAcJ,KAAIU,MAAlBN,GAAmBN,MAAIa,OAAIJ,GAEtC,EAIA,IAAMK,EAAe5D,MAAM2C,UAAUkB,OACrC7D,MAAM2C,UAAUkB,OAAS,eAEjBnC,EAF6CoC,EAAAhB,KAAfS,EAAe,GAAAC,MAAAR,KAAAS,WACnD,OAAIjB,EAAsBM,OAGtBC,EAAAA,MAAM,WAAQrB,EAASkC,EAAaZ,KAAIU,MAAjBE,EAAY,CAAME,GAAIH,OAAIJ,GAAW,GAEvD7B,GAGAkC,EAAaZ,KAAIU,MAAjBE,GAAkBd,MAAIa,OAAIJ,GAErC,yCA7NwB,SAAmBQ,GAC5C,IAAKlD,EAAYkD,GAAM,UAAUvE,MAAM,kCAGvC,OAFKd,EAAWwB,IAAI6D,IACnBrF,EAAWyB,IAAI4D,EAAK9E,EAAY8E,EAAKjD,IAC/BpC,EAAWe,IAAIsE,EACvB,SAEoB,SAInBA,EACAxD,GAEAvB,GAAU,EACV,IAAM2B,EAAQoD,EAAIxD,GAClB,IACCvB,GAAU,CACV,CAAC,MAAOgF,GACT,CAAA,OAAOrD,CACR"}