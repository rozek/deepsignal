import"@preact/signals-react";import{useMemo as e}from"react";import{Signal as t,signal as r,computed as n}from"@preact/signals-core";const s=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakSet,l=new WeakMap,g=/^\$/;let i=!1;const u=e=>{if(!d(e))throw new Error("This object can't be observed.");return a.has(e)||a.set(e,p(e,w)),a.get(e)},f=(e,t)=>{i=!0;const r=e[t];try{i=!1}catch(e){}return r},p=(e,t)=>{const r=new Proxy(e,t);return c.add(r),r},h=()=>{throw new Error("Don't mutate the signals directly.")},y=e=>(t,c,l)=>{var u;if(i)return Reflect.get(t,c,l);let f=e||"$"===c[0]&&"$"!==c;if(!e&&f&&Array.isArray(t)){if("$"===c)return o.has(t)||o.set(t,p(t,m)),o.get(t);f="$length"===c}s.has(l)||s.set(l,new Map);const h=s.get(l),y=f?c.replace(g,""):c;if(h.has(y)||"function"!=typeof(null==(u=Object.getOwnPropertyDescriptor(t,y))?void 0:u.get)){let e=Reflect.get(t,y,l);if(f&&"function"==typeof e)return;if("symbol"==typeof y&&v.has(y))return e;h.has(y)||(d(e)&&(a.has(e)||a.set(e,p(e,w)),e=a.get(e)),h.set(y,r(e)))}else h.set(y,n(()=>Reflect.get(t,y,l)));return f?h.get(y):h.get(y).value},w={get:y(!1),set(e,n,o,c){s.has(c)||s.set(c,new Map);const l=s.get(c);if("$"===n[0]&&"$"!==n){o instanceof t||h();const r=n.replace(g,"");return l.set(r,o),Reflect.set(e,r,o.peek(),c)}{let t=o;d(o)&&(a.has(o)||a.set(o,p(o,w)),t=a.get(o));const s=Reflect.set(e,n,o,c);return l.has(n)?l.get(n).value=t:l.set(n,r(t)),Array.isArray(e)&&l.has("length")&&(l.get("length").value=e.length),s}},defineProperty(e,t,r){"$"===t[0]&&"$"!==t&&h();const n=!(t in e),o=s.get(a.get(e)),c=Reflect.defineProperty(e,t,r);return"value"in r&&o&&o.has(t)&&(o.get(t).value=r.value),n&&l.has(e)&&l.get(e).value++,c},deleteProperty(e,t){"$"===t[0]&&"$"!==t&&h();const r=s.get(a.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),l.has(e)&&l.get(e).value++,n},ownKeys:e=>(l.has(e)||l.set(e,r(0)),l._=l.get(e).value,Reflect.ownKeys(e))},m={get:y(!0),set:h,deleteProperty:h},v=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(e=>"symbol"==typeof e)),b=new Set([Object,Array]),d=e=>"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!c.has(e),$=t=>e(()=>u(t),[]);export{u as deepSignal,f as peek,$ as useDeepSignal};
//# sourceMappingURL=deepsignal-react.mjs.map
