!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-react"),require("react"),require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-react","react","@preact/signals-core"],t):t((e||self).deepsignalReact={},0,e.react,e.signalsCore)}(this,function(e,t,n,r){var a=new WeakMap,o=new WeakMap,s=new WeakMap,i=new WeakSet,c=new WeakMap,u=/^\$/,l=!1,f=function(e){if(!b(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,g(e,y)),o.get(e)},g=function(e,t){var n=new Proxy(e,t);return i.add(n),n},p=function(){throw new Error("Don't mutate the signals directly.")},h=function(e){return function(t,n,i){var c;if(l)return Reflect.get(t,n,i);var f=e||"$"===n[0];if(!e&&f&&Array.isArray(t)){if("$"===n)return s.has(t)||s.set(t,g(t,d)),s.get(t);f="$length"===n}a.has(i)||a.set(i,new Map);var p=a.get(i),h=f?n.replace(u,""):n;if(p.has(h)||"function"!=typeof(null==(c=Object.getOwnPropertyDescriptor(t,h))?void 0:c.get)){var w=Reflect.get(t,h,i);if(f&&"function"==typeof w)return;if("symbol"==typeof h&&v.has(h))return w;p.has(h)||(b(w)&&(o.has(w)||o.set(w,g(w,y)),w=o.get(w)),p.set(h,r.signal(w)))}else p.set(h,r.computed(function(){return Reflect.get(t,h,i)}));return f?p.get(h):p.get(h).value}},y={get:h(!1),set:function(e,t,n,s){a.has(s)||a.set(s,new Map);var i=a.get(s);if("$"===t[0]){n instanceof r.Signal||p();var l=t.replace(u,"");return i.set(l,n),Reflect.set(e,l,n.peek(),s)}var f=n;b(n)&&(o.has(n)||o.set(n,g(n,y)),f=o.get(n));var h=!(t in e),d=Reflect.set(e,t,n,s);return i.has(t)?i.get(t).value=f:i.set(t,r.signal(f)),h&&c.has(e)&&c.get(e).value++,Array.isArray(e)&&i.has("length")&&(i.get("length").value=e.length),d},deleteProperty:function(e,t){"$"===t[0]&&p();var n=a.get(o.get(e)),r=Reflect.deleteProperty(e,t);return n&&n.has(t)&&(n.get(t).value=void 0),c.has(e)&&c.get(e).value++,r},ownKeys:function(e){return c.has(e)||c.set(e,r.signal(0)),c.get(e),Reflect.ownKeys(e)}},d={get:h(!0),set:p,deleteProperty:p},v=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),w=new Set([Object,Array]),b=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||w.has(e.constructor))&&!i.has(e)};e.deepSignal=f,e.peek=function(e,t){return l=!0,l=!1,e[t]},e.useDeepSignal=function(e){return n.useMemo(function(){return f(e)},[])}});
//# sourceMappingURL=deepsignal-react.min.js.map
