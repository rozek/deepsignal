!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-react"),require("react"),require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-react","react","@preact/signals-core"],t):t((e||self).deepsignalReact={},0,e.react,e.signalsCore)}(this,function(e,t,r,n){var a=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,i=new WeakMap,l=/^\$/,u=!1,f=function(e){if(!w(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,p(e,g)),o.get(e)},p=function(e,t){var r=new Proxy(e,t);return s.add(r),r},h=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(t,r,s){var i;if(u)return Reflect.get(t,r,s);var f=e||"$"===r[0]&&"$"!==r;if(!e&&f&&Array.isArray(t)){if("$"===r)return c.has(t)||c.set(t,p(t,v)),c.get(t);f="$length"===r}a.has(s)||a.set(s,new Map);var h=a.get(s),y=f?r.replace(l,""):r;if(h.has(y)||"function"!=typeof(null==(i=Object.getOwnPropertyDescriptor(t,y))?void 0:i.get)){var b=Reflect.get(t,y,s);if(f&&"function"==typeof b)return;if("symbol"==typeof y&&d.has(y))return b;h.has(y)||(w(b)&&(o.has(b)||o.set(b,p(b,g)),b=o.get(b)),h.set(y,n.signal(b)))}else h.set(y,n.computed(function(){return Reflect.get(t,y,s)}));return f?h.get(y):h.get(y).value}},g={get:y(!1),set:function(e,t,r,c){a.has(c)||a.set(c,new Map);var s=a.get(c);if("$"===t[0]&&"$"!==t){r instanceof n.Signal||h();var i=t.replace(l,"");return s.set(i,r),Reflect.set(e,i,r.peek(),c)}var u=r;w(r)&&(o.has(r)||o.set(r,p(r,g)),u=o.get(r));var f=Reflect.set(e,t,r,c);return s.has(t)?s.get(t).value=u:s.set(t,n.signal(u)),Array.isArray(e)&&s.has("length")&&(s.get("length").value=e.length),f},defineProperty:function(e,t,r){"$"===t[0]&&"$"!==t&&h();var n=!(t in e),c=a.get(o.get(e)),s=Reflect.defineProperty(e,t,r);return"value"in r&&c&&c.has(t)&&(c.get(t).value=r.value),n&&i.has(e)&&i.get(e).value++,s},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&h();var r=a.get(o.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),i.has(e)&&i.get(e).value++,n},ownKeys:function(e){return i.has(e)||i.set(e,n.signal(0)),i._=i.get(e).value,Reflect.ownKeys(e)}},v={get:y(!0),set:h,deleteProperty:h},d=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),w=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!s.has(e)};function m(e){return s.has(e)}var A=Array.prototype.pop;Array.prototype.pop=function(){var e,t=this;return m(this)?(n.batch(function(){e=A.call(t)}),e):A.call(this)};var $=Array.prototype.shift;Array.prototype.shift=function(){var e,t=this;return m(this)?(n.batch(function(){e=$.call(t)}),e):$.call(this)};var R=Array.prototype.unshift;Array.prototype.unshift=function(){var e,t=this,r=[].slice.call(arguments);return m(this)?(n.batch(function(){e=R.call.apply(R,[t].concat(r))}),e):R.call.apply(R,[this].concat(r))};var P=Array.prototype.splice;Array.prototype.splice=function(){var e,t=this,r=[].slice.call(arguments);return m(this)?(n.batch(function(){e=P.call.apply(P,[t].concat(r))}),e):P.call.apply(P,[this].concat(r))},e.ValueIsDeeplyObserved=m,e.deepSignal=f,e.peek=function(e,t){u=!0;var r=e[t];try{u=!1}catch(e){}return r},e.useDeepSignal=function(e){return r.useMemo(function(){return f(e)},[])}});
//# sourceMappingURL=deepsignal-react.min.js.map
