import"@preact/signals-react";import{useMemo as e}from"react";import{Signal as t,signal as r,computed as n}from"@preact/signals-core";var a=new WeakMap,o=new WeakMap,s=new WeakMap,u=new WeakSet,c=new WeakMap,i=/^\$/,f=!1,l=function(e){if(!d(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,p(e,v)),o.get(e)},g=function(e,t){f=!0;var r=e[t];try{f=!1}catch(e){}return r},p=function(e,t){var r=new Proxy(e,t);return u.add(r),r},h=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(t,u,c){var l;if(f)return Reflect.get(t,u,c);var g=e||"$"===u[0]&&"$"!==u;if(!e&&g&&Array.isArray(t)){if("$"===u)return s.has(t)||s.set(t,p(t,w)),s.get(t);g="$length"===u}a.has(c)||a.set(c,new Map);var h=a.get(c),y=g?u.replace(i,""):u;if(h.has(y)||"function"!=typeof(null==(l=Object.getOwnPropertyDescriptor(t,y))?void 0:l.get)){var b=Reflect.get(t,y,c);if(g&&"function"==typeof b)return;if("symbol"==typeof y&&m.has(y))return b;h.has(y)||(d(b)&&(o.has(b)||o.set(b,p(b,v)),b=o.get(b)),h.set(y,r(b)))}else h.set(y,n(function(){return Reflect.get(t,y,c)}));return g?h.get(y):h.get(y).value}},v={get:y(!1),set:function(e,n,s,u){a.has(u)||a.set(u,new Map);var c=a.get(u);if("$"===n[0]&&"$"!==n){s instanceof t||h();var f=n.replace(i,"");return c.set(f,s),Reflect.set(e,f,s.peek(),u)}var l=s;d(s)&&(o.has(s)||o.set(s,p(s,v)),l=o.get(s));var g=Reflect.set(e,n,s,u);return c.has(n)?c.get(n).value=l:c.set(n,r(l)),Array.isArray(e)&&c.has("length")&&(c.get("length").value=e.length),g},defineProperty:function(e,t,r){"$"===t[0]&&"$"!==t&&h();var n=!(t in e),s=a.get(o.get(e)),u=Reflect.defineProperty(e,t,r);return"value"in r&&s&&s.has(t)&&(s.get(t).value=r.value),n&&c.has(e)&&c.get(e).value++,u},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&h();var r=a.get(o.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,n},ownKeys:function(e){return c.has(e)||c.set(e,r(0)),c._=c.get(e).value,Reflect.ownKeys(e)}},w={get:y(!0),set:h,deleteProperty:h},m=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),d=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!u.has(e)},$=function(t){return e(function(){return l(t)},[])};export{l as deepSignal,g as peek,$ as useDeepSignal};
//# sourceMappingURL=deepsignal-react.module.js.map
