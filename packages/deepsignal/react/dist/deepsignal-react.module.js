import"@preact/signals-react";import{useMemo as e}from"react";import{batch as t,Signal as r,signal as n,computed as a}from"@preact/signals-core";var o=new WeakMap,c=new WeakMap,s=new WeakMap,u=new WeakSet,i=new WeakMap,l=/^\$/,f=!1,p=function(e){if(!P(e))throw new Error("This object can't be observed.");return c.has(e)||c.set(e,y(e,m)),c.get(e)},g=function(e,t){f=!0;var r=e[t];try{f=!1}catch(e){}return r};function h(e,t){var r=t?g(e,t):e;return u.add(r),r}var y=function(e,t){var r=new Proxy(e,t);return u.add(r),r},v=function(){throw new Error("Don't mutate the signals directly.")},w=function(e){return function(t,r,u){var i;if(f)return Reflect.get(t,r,u);var p=e||"$"===r[0]&&"$"!==r;if(!e&&p&&Array.isArray(t)){if("$"===r)return s.has(t)||s.set(t,y(t,b)),s.get(t);p="$length"===r}o.has(u)||o.set(u,new Map);var g=o.get(u),h=p?r.replace(l,""):r;if(g.has(h)||"function"!=typeof(null==(i=Object.getOwnPropertyDescriptor(t,h))?void 0:i.get)){var v=Reflect.get(t,h,u);if(p&&"function"==typeof v)return;if("symbol"==typeof h&&d.has(h))return v;g.has(h)||(P(v)&&(c.has(v)||c.set(v,y(v,m)),v=c.get(v)),g.set(h,n(v))),g.get(h).value=v}else g.set(h,a(function(){return Reflect.get(t,h,u)}));return p?g.get(h):g.get(h).value}},m={get:w(!1),set:function(e,t,a,s){o.has(s)||o.set(s,new Map);var u=o.get(s);if("$"===t[0]&&"$"!==t){a instanceof r||v();var i=t.replace(l,"");return u.set(i,a),Reflect.set(e,i,a.peek(),s)}var f=a;P(a)&&(c.has(a)||c.set(a,y(a,m)),f=c.get(a));var p=Reflect.set(e,t,a,s);return u.has(t)?u.get(t).value=f:u.set(t,n(f)),Array.isArray(e)&&u.has("length")&&(u.get("length").value=e.length),p},defineProperty:function(e,t,r){"$"===t[0]&&"$"!==t&&v();var n=!(t in e),a=o.get(c.get(e)),s=Reflect.defineProperty(e,t,r);return"value"in r&&a&&a.has(t)&&(a.get(t).value=r.value),n&&i.has(e)&&i.get(e).value++,s},deleteProperty:function(e,t){"$"===t[0]&&"$"!==t&&v();var r=o.get(c.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),i.has(e)&&i.get(e).value++,n},ownKeys:function(e){return i.has(e)||i.set(e,n(0)),i._=i.get(e).value,Reflect.ownKeys(e)}},b={get:w(!0),set:v,deleteProperty:v},d=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),$=new Set([Object,Array]),P=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||$.has(e.constructor))&&!u.has(e)};function R(e){return u.has(e)}["copyWithin","fill","pop","reverse","shift","sort","splice","unshift"].forEach(function(e){var r;Array.prototype[e]=(r=Array.prototype[e],function(){var e,n=this,a=[].slice.call(arguments);return R(this)?(t(function(){e=r.call.apply(r,[n].concat(a))}),e):r.call.apply(r,[this].concat(a))})});var A=function(t){return e(function(){return p(t)},[])};export{R as ValueIsDeeplyObserved,p as deepSignal,g as peek,h as shallow,A as useDeepSignal};
//# sourceMappingURL=deepsignal-react.module.js.map
